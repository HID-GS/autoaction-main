name: Auto PR on Parent Repo Responder

on: [repository_dispatch]

jobs:
  auto-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: 'true'
      - name: create ssh key
        run: |
          mkdir ${HOME}/.ssh; \
          echo ${{ secrets.AAKEY }} > ${HOME}/.ssh/id_ed25519; \
          sudo chmod 700 ${HOME}/.ssh; \
          sudo chmod 600 ${HOME}/.ssh/id_ed25519; \
      - name: Event Information
        run: |
          echo "Event '${{ github.event.action }}' received from '${{ github.event.client_payload.repository }}' commit '${{ github.event.client_payload.sha }}'"
      - name: APOP Create PR
        if: github.event.action == 'apop-pr-merged'
        run: |
          env | sort; \
          ls -la; \
          cd ${{ github.event.client_playload.repository }}; \
          git fetch --all; \
          git co ${{ github.event.client_payload.sha }}
